{"ast":null,"code":"var _jsxFileName = \"/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\n// Assuming your API and crypto services are correctly located\n// import { usersAPI, messagesAPI } from '../../services/api'; \n// import { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\n// import { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, LockClosedIcon, PhoneIcon, EllipsisVerticalIcon, MagnifyingGlassIcon, FaceSmileIcon, PaperClipIcon, UserCircleIcon } from '@heroicons/react/24/solid';\n\n// --- MOCK SERVICES FOR UI DEMONSTRATION ---\n// This section simulates your backend services to make the component runnable for UI review.\n// In your actual project, you would REMOVE this section and use your real imports.\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst usersAPI = {\n  getAllUsers: () => Promise.resolve({\n    data: [{\n      username: 'rounak',\n      publicKey: '...',\n      isOnline: true\n    }, {\n      username: 'test2',\n      publicKey: '...',\n      isOnline: false\n    }, {\n      username: 'alice',\n      publicKey: '...',\n      isOnline: true\n    }, {\n      username: 'bob',\n      publicKey: '...',\n      isOnline: false\n    }]\n  })\n};\nconst messagesAPI = {\n  getConversation: username => Promise.resolve({\n    data: [{\n      from: 'rounak',\n      to: 'test',\n      encryptedContent: 'Hey there!',\n      encryptedAESKey: '...',\n      timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString()\n    }, {\n      from: 'test',\n      to: 'rounak',\n      encryptedContent: 'Hello! How are you?',\n      encryptedAESKey: '...',\n      timestamp: new Date(Date.now() - 1000 * 60 * 4).toISOString(),\n      plaintext: 'Hello! How are you?'\n    }]\n  }),\n  sendMessage: data => Promise.resolve({\n    data\n  })\n};\nconst getSocket = () => ({\n  on: () => {},\n  off: () => {},\n  emit: () => {}\n});\nconst decryptPrivateKeyAES = async (key, pass) => 'decrypted-private-key';\nconst hybridEncryptMessage = async (msg, key) => ({\n  encryptedMessage: msg,\n  encryptedAESKey: '...'\n});\nconst hybridDecryptMessage = async (msg, aesKey, privKey) => msg;\n// --- END OF MOCK SERVICES ---\n\n// --- React Components ---\n\nconst MessageItem = ({\n  msg,\n  currentUser,\n  getDecryptedPrivateKey\n}) => {\n  _s();\n  const [decrypted, setDecrypted] = useState('[Encrypted]');\n  useEffect(() => {\n    const decrypt = async () => {\n      // If the message was sent by the current user and has a plaintext copy, show it immediately.\n      if (msg.from === currentUser.username && msg.plaintext) {\n        setDecrypted(msg.plaintext);\n        return;\n      }\n      // Otherwise, attempt to decrypt the message.\n      try {\n        const privateKeyArmored = await getDecryptedPrivateKey();\n        const decryptedMessage = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n        setDecrypted(decryptedMessage);\n      } catch (err) {\n        console.error(\"Decryption failed:\", err);\n        setDecrypted('[Failed to decrypt]');\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n  const isSent = msg.from === currentUser.username;\n  const time = new Date(msg.timestamp || Date.now()).toLocaleTimeString([], {\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `flex w-full ${isSent ? 'justify-end' : 'justify-start'}`,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `max-w-[70%] px-4 py-3 rounded-2xl shadow-md ${isSent ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-slate-700 text-gray-200 rounded-bl-none'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"break-words text-base\",\n        children: decrypted\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-1.5 mt-1.5 text-xs text-right opacity-70\",\n        children: [/*#__PURE__*/_jsxDEV(LockClosedIcon, {\n          className: \"h-3 w-3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: time\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n};\n_s(MessageItem, \"rwFUbRDQV9yXdu8swD2DY2kdzJk=\");\n_c = MessageItem;\nconst ChatPage = ({\n  showStatus = (msg, type) => console.log(`${type}: ${msg}`)\n}) => {\n  _s2();\n  // --- EXISTING LOGIC (UNCHANGED) ---\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n  const messagesEndRef = useRef(null);\n\n  // Hardcoded current user for demonstration\n  const currentUser = {\n    username: 'test'\n  };\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n    }\n  }, [selectedUser]);\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', msg => {\n      if (msg.from === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) || msg.to === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username)) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => socket.off('receive_message');\n  }, [selectedUser]);\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages]);\n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      if (!passphrase) throw new Error(\"Password not provided.\");\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n  const sendMessage = async e => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      const {\n        encryptedMessage,\n        encryptedAESKey\n      } = await hybridEncryptMessage(input, selectedUser.publicKey);\n      const messageData = {\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      };\n      await messagesAPI.sendMessage(messageData);\n      const sentMessage = {\n        from: currentUser.username,\n        to: selectedUser.username,\n        ...messageData,\n        timestamp: new Date().toISOString(),\n        plaintext: input\n      };\n      setMessages(prev => [...prev, sentMessage]);\n      getSocket().emit('send_message', sentMessage);\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus(`Failed to send message: ${err.message}`, 'error');\n    }\n    setLoading(false);\n  };\n  // --- END OF EXISTING LOGIC ---\n\n  const getAvatar = username => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative flex items-center justify-center w-11 h-11 rounded-full bg-slate-600 text-white font-bold text-lg select-none flex-shrink-0\",\n    children: username.slice(0, 2).toUpperCase()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 169,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-screen w-screen bg-slate-900 text-gray-200 flex font-sans\",\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: \"w-full md:w-1/3 lg:w-1/4 h-full bg-slate-800 flex flex-col border-r border-slate-700\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 border-b border-slate-700 flex-shrink-0\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2 mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(LockClosedIcon, {\n            className: \"h-6 w-6 text-indigo-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-xl font-bold text-white\",\n            children: \"SecureChat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Search or start new chat\",\n            className: \"w-full bg-slate-900 border border-slate-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(MagnifyingGlassIcon, {\n            className: \"h-5 w-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-grow overflow-y-auto p-2 space-y-1\",\n        children: users.filter(u => u.username !== currentUser.username).map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n          onClick: () => setSelectedUser(user),\n          className: `flex items-center p-3 cursor-pointer rounded-lg transition-colors duration-200 ${(selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) === user.username ? 'bg-indigo-600/30' : 'hover:bg-slate-700/50'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [getAvatar(user.username), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `absolute bottom-0 right-0 block h-3 w-3 rounded-full border-2 border-slate-800 ${user.isOnline ? 'bg-green-500' : 'bg-gray-500'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-grow ml-4 min-w-0\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"font-bold text-white truncate\",\n              children: user.username\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm text-slate-400 truncate\",\n              children: \"Click to view messages\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 205,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 203,\n            columnNumber: 15\n          }, this)]\n        }, user.username, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"w-full md:w-2/3 lg:w-3/4 h-full flex flex-col bg-slate-900\",\n      children: selectedUser ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"header\", {\n          className: \"flex items-center justify-between p-4 bg-slate-800/80 backdrop-blur-sm border-b border-slate-700 flex-shrink-0\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center min-w-0\",\n            children: [getAvatar(selectedUser.username), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ml-4 min-w-0\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"font-bold text-white truncate\",\n                children: selectedUser.username\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: `text-sm ${selectedUser.isOnline ? 'text-green-400' : 'text-slate-400'}`,\n                children: selectedUser.isOnline ? 'Online' : 'Offline'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\",\n              children: /*#__PURE__*/_jsxDEV(PhoneIcon, {\n                className: \"h-6 w-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 226,\n                columnNumber: 123\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 226,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\",\n              children: /*#__PURE__*/_jsxDEV(EllipsisVerticalIcon, {\n                className: \"h-6 w-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 227,\n                columnNumber: 123\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-grow p-4 md:p-6 overflow-y-auto flex flex-col-reverse\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-col gap-4\",\n            children: [messages.slice().reverse().map((msg, index) => /*#__PURE__*/_jsxDEV(MessageItem, {\n              msg: msg,\n              currentUser: currentUser,\n              getDecryptedPrivateKey: getDecryptedPrivateKey\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 23\n            }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: messagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"footer\", {\n          className: \"p-4 bg-slate-800/80 backdrop-blur-sm border-t border-slate-700 flex-shrink-0\",\n          children: /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: sendMessage,\n            className: \"flex items-center gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\",\n              children: /*#__PURE__*/_jsxDEV(FaceSmileIcon, {\n                className: \"h-6 w-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 137\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\",\n              children: /*#__PURE__*/_jsxDEV(PaperClipIcon, {\n                className: \"h-6 w-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 245,\n                columnNumber: 137\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: input,\n              onChange: e => setInput(e.target.value),\n              onKeyDown: e => e.key === 'Enter' && !e.shiftKey && sendMessage(e),\n              placeholder: \"Type a secure message...\",\n              className: \"flex-grow bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none\",\n              rows: 1,\n              style: {\n                maxHeight: '10rem'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"bg-indigo-600 p-3 rounded-full text-white hover:bg-indigo-700 disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors flex-shrink-0\",\n              disabled: !input.trim() || loading,\n              children: /*#__PURE__*/_jsxDEV(PaperAirplaneIcon, {\n                className: \"h-6 w-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 256,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col items-center justify-center h-full text-slate-400 text-center p-4\",\n        children: [/*#__PURE__*/_jsxDEV(UserCircleIcon, {\n          className: \"h-24 w-24 text-slate-700\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"mt-4 text-2xl font-bold text-slate-300\",\n          children: \"Welcome to SecureChat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-2 max-w-sm\",\n          children: \"Your conversations are end-to-end encrypted. Select a user from the sidebar to begin a secure conversation.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 5\n  }, this);\n};\n_s2(ChatPage, \"KmNW8gcEY8OWYye3bZM5to73UKs=\");\n_c2 = ChatPage;\nexport default ChatPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"MessageItem\");\n$RefreshReg$(_c2, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","PaperAirplaneIcon","LockClosedIcon","PhoneIcon","EllipsisVerticalIcon","MagnifyingGlassIcon","FaceSmileIcon","PaperClipIcon","UserCircleIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","usersAPI","getAllUsers","Promise","resolve","data","username","publicKey","isOnline","messagesAPI","getConversation","from","to","encryptedContent","encryptedAESKey","timestamp","Date","now","toISOString","plaintext","sendMessage","getSocket","on","off","emit","decryptPrivateKeyAES","key","pass","hybridEncryptMessage","msg","encryptedMessage","hybridDecryptMessage","aesKey","privKey","MessageItem","currentUser","getDecryptedPrivateKey","_s","decrypted","setDecrypted","decrypt","privateKeyArmored","decryptedMessage","err","console","error","isSent","time","toLocaleTimeString","hour","minute","className","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","ChatPage","showStatus","type","log","_s2","users","setUsers","selectedUser","setSelectedUser","messages","setMessages","input","setInput","loading","setLoading","decryptedPrivateKeyRef","passphraseRef","messagesEndRef","then","res","socket","prev","_messagesEndRef$curre","current","scrollIntoView","behavior","encryptedPrivateKey","localStorage","getItem","passphrase","window","prompt","Error","e","preventDefault","messageData","messageType","sentMessage","message","getAvatar","slice","toUpperCase","placeholder","filter","u","map","user","onClick","reverse","index","ref","onSubmit","value","onChange","target","onKeyDown","shiftKey","rows","style","maxHeight","disabled","trim","_c2","$RefreshReg$"],"sources":["/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\n// Assuming your API and crypto services are correctly located\n// import { usersAPI, messagesAPI } from '../../services/api'; \n// import { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\n// import { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, LockClosedIcon, PhoneIcon, EllipsisVerticalIcon, MagnifyingGlassIcon, FaceSmileIcon, PaperClipIcon, UserCircleIcon } from '@heroicons/react/24/solid';\n\n// --- MOCK SERVICES FOR UI DEMONSTRATION ---\n// This section simulates your backend services to make the component runnable for UI review.\n// In your actual project, you would REMOVE this section and use your real imports.\nconst usersAPI = {\n  getAllUsers: () => Promise.resolve({ data: [\n    { username: 'rounak', publicKey: '...', isOnline: true },\n    { username: 'test2', publicKey: '...', isOnline: false },\n    { username: 'alice', publicKey: '...', isOnline: true },\n    { username: 'bob', publicKey: '...', isOnline: false },\n  ]})\n};\nconst messagesAPI = {\n  getConversation: (username) => Promise.resolve({ data: [\n    { from: 'rounak', to: 'test', encryptedContent: 'Hey there!', encryptedAESKey: '...', timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString() },\n    { from: 'test', to: 'rounak', encryptedContent: 'Hello! How are you?', encryptedAESKey: '...', timestamp: new Date(Date.now() - 1000 * 60 * 4).toISOString(), plaintext: 'Hello! How are you?' },\n  ]}),\n  sendMessage: (data) => Promise.resolve({ data })\n};\nconst getSocket = () => ({\n  on: () => {},\n  off: () => {},\n  emit: () => {},\n});\nconst decryptPrivateKeyAES = async (key, pass) => 'decrypted-private-key';\nconst hybridEncryptMessage = async (msg, key) => ({ encryptedMessage: msg, encryptedAESKey: '...' });\nconst hybridDecryptMessage = async (msg, aesKey, privKey) => msg;\n// --- END OF MOCK SERVICES ---\n\n\n// --- React Components ---\n\nconst MessageItem = ({ msg, currentUser, getDecryptedPrivateKey }) => {\n  const [decrypted, setDecrypted] = useState('[Encrypted]');\n\n  useEffect(() => {\n    const decrypt = async () => {\n      // If the message was sent by the current user and has a plaintext copy, show it immediately.\n      if (msg.from === currentUser.username && msg.plaintext) {\n        setDecrypted(msg.plaintext);\n        return;\n      }\n      // Otherwise, attempt to decrypt the message.\n      try {\n        const privateKeyArmored = await getDecryptedPrivateKey();\n        const decryptedMessage = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n        setDecrypted(decryptedMessage);\n      } catch (err) {\n        console.error(\"Decryption failed:\", err);\n        setDecrypted('[Failed to decrypt]');\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n\n  const isSent = msg.from === currentUser.username;\n  const time = new Date(msg.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  \n  return (\n    <div className={`flex w-full ${isSent ? 'justify-end' : 'justify-start'}`}>\n      <div className={`max-w-[70%] px-4 py-3 rounded-2xl shadow-md ${isSent ? 'bg-indigo-600 text-white rounded-br-none' : 'bg-slate-700 text-gray-200 rounded-bl-none'}`}>\n        <p className=\"break-words text-base\">{decrypted}</p>\n        <div className=\"flex items-center gap-1.5 mt-1.5 text-xs text-right opacity-70\">\n          <LockClosedIcon className=\"h-3 w-3\" />\n          <span>{time}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n\nconst ChatPage = ({ showStatus = (msg, type) => console.log(`${type}: ${msg}`) }) => {\n  // --- EXISTING LOGIC (UNCHANGED) ---\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n  const messagesEndRef = useRef(null);\n  \n  // Hardcoded current user for demonstration\n  const currentUser = { username: 'test' };\n\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n    }\n  }, [selectedUser]);\n\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', (msg) => {\n      if (msg.from === selectedUser?.username || msg.to === selectedUser?.username) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => socket.off('receive_message');\n  }, [selectedUser]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n  \n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      if (!passphrase) throw new Error(\"Password not provided.\");\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      const { encryptedMessage, encryptedAESKey } = await hybridEncryptMessage(input, selectedUser.publicKey);\n      const messageData = { to: selectedUser.username, encryptedContent: encryptedMessage, encryptedAESKey, messageType: 'text' };\n      await messagesAPI.sendMessage(messageData);\n      \n      const sentMessage = {\n          from: currentUser.username,\n          to: selectedUser.username,\n          ...messageData,\n          timestamp: new Date().toISOString(),\n          plaintext: input\n      };\n      \n      setMessages(prev => [...prev, sentMessage]);\n      getSocket().emit('send_message', sentMessage);\n\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus(`Failed to send message: ${err.message}`, 'error');\n    }\n    setLoading(false);\n  };\n  // --- END OF EXISTING LOGIC ---\n  \n  const getAvatar = (username) => (\n    <div className=\"relative flex items-center justify-center w-11 h-11 rounded-full bg-slate-600 text-white font-bold text-lg select-none flex-shrink-0\">\n      {username.slice(0, 2).toUpperCase()}\n    </div>\n  );\n\n  return (\n    <div className=\"h-screen w-screen bg-slate-900 text-gray-200 flex font-sans\">\n      {/* Sidebar */}\n      <aside className=\"w-full md:w-1/3 lg:w-1/4 h-full bg-slate-800 flex flex-col border-r border-slate-700\">\n        <div className=\"p-4 border-b border-slate-700 flex-shrink-0\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <LockClosedIcon className=\"h-6 w-6 text-indigo-400\" />\n            <h1 className=\"text-xl font-bold text-white\">SecureChat</h1>\n          </div>\n          <div className=\"relative\">\n            <input\n              type=\"text\"\n              placeholder=\"Search or start new chat\"\n              className=\"w-full bg-slate-900 border border-slate-700 rounded-lg py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-indigo-500\"\n            />\n            <MagnifyingGlassIcon className=\"h-5 w-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2\"/>\n          </div>\n        </div>\n        <div className=\"flex-grow overflow-y-auto p-2 space-y-1\">\n          {users.filter(u => u.username !== currentUser.username).map(user => (\n            <div\n              key={user.username}\n              onClick={() => setSelectedUser(user)}\n              className={`flex items-center p-3 cursor-pointer rounded-lg transition-colors duration-200 ${selectedUser?.username === user.username ? 'bg-indigo-600/30' : 'hover:bg-slate-700/50'}`}\n            >\n              <div className=\"relative\">\n                {getAvatar(user.username)}\n                <span className={`absolute bottom-0 right-0 block h-3 w-3 rounded-full border-2 border-slate-800 ${user.isOnline ? 'bg-green-500' : 'bg-gray-500'}`}></span>\n              </div>\n              <div className=\"flex-grow ml-4 min-w-0\">\n                <p className=\"font-bold text-white truncate\">{user.username}</p>\n                <p className=\"text-sm text-slate-400 truncate\">Click to view messages</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </aside>\n\n      {/* Main Chat Window */}\n      <main className=\"w-full md:w-2/3 lg:w-3/4 h-full flex flex-col bg-slate-900\">\n        {selectedUser ? (\n          <>\n            {/* Chat Header */}\n            <header className=\"flex items-center justify-between p-4 bg-slate-800/80 backdrop-blur-sm border-b border-slate-700 flex-shrink-0\">\n              <div className=\"flex items-center min-w-0\">\n                {getAvatar(selectedUser.username)}\n                <div className=\"ml-4 min-w-0\">\n                  <p className=\"font-bold text-white truncate\">{selectedUser.username}</p>\n                  <p className={`text-sm ${selectedUser.isOnline ? 'text-green-400' : 'text-slate-400'}`}>{selectedUser.isOnline ? 'Online' : 'Offline'}</p>\n                </div>\n              </div>\n              <div className='flex items-center gap-2'>\n                <button className=\"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\"><PhoneIcon className=\"h-6 w-6\"/></button>\n                <button className=\"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\"><EllipsisVerticalIcon className=\"h-6 w-6\"/></button>\n              </div>\n            </header>\n\n            {/* Message Area */}\n            <div className=\"flex-grow p-4 md:p-6 overflow-y-auto flex flex-col-reverse\">\n              <div className=\"flex flex-col gap-4\">\n                  {messages.slice().reverse().map((msg, index) => (\n                      <MessageItem key={index} msg={msg} currentUser={currentUser} getDecryptedPrivateKey={getDecryptedPrivateKey} />\n                  ))}\n                  <div ref={messagesEndRef} />\n              </div>\n            </div>\n\n            {/* Message Input */}\n            <footer className=\"p-4 bg-slate-800/80 backdrop-blur-sm border-t border-slate-700 flex-shrink-0\">\n              <form onSubmit={sendMessage} className=\"flex items-center gap-3\">\n                <button type=\"button\" className=\"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\"><FaceSmileIcon className=\"h-6 w-6\"/></button>\n                <button type=\"button\" className=\"p-2 rounded-full text-slate-400 hover:bg-slate-700 hover:text-white transition-colors\"><PaperClipIcon className=\"h-6 w-6\"/></button>\n                <textarea\n                  value={input}\n                  onChange={e => setInput(e.target.value)}\n                  onKeyDown={e => e.key === 'Enter' && !e.shiftKey && sendMessage(e)}\n                  placeholder=\"Type a secure message...\"\n                  className=\"flex-grow bg-slate-700 border border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none\"\n                  rows={1}\n                  style={{ maxHeight: '10rem' }}\n                />\n                <button type=\"submit\" className=\"bg-indigo-600 p-3 rounded-full text-white hover:bg-indigo-700 disabled:bg-slate-600 disabled:cursor-not-allowed transition-colors flex-shrink-0\" disabled={!input.trim() || loading}>\n                  <PaperAirplaneIcon className=\"h-6 w-6\" />\n                </button>\n              </form>\n            </footer>\n          </>\n        ) : (\n          <div className=\"flex flex-col items-center justify-center h-full text-slate-400 text-center p-4\">\n            <UserCircleIcon className=\"h-24 w-24 text-slate-700\" />\n            <h2 className=\"mt-4 text-2xl font-bold text-slate-300\">Welcome to SecureChat</h2>\n            <p className=\"mt-2 max-w-sm\">Your conversations are end-to-end encrypted. Select a user from the sidebar to begin a secure conversation.</p>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n};\n\nexport default ChatPage;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
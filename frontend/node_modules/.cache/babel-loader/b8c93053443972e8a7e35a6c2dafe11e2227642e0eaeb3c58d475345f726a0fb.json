{"ast":null,"code":"var _jsxFileName = \"/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { usersAPI, messagesAPI } from '../../services/api';\nimport { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\nimport { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, MagnifyingGlassIcon, UserCircleIcon, Bars3Icon } from '@heroicons/react/24/solid';\nimport './ChatContainer.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatContainer = ({\n  currentUser,\n  showStatus\n}) => {\n  _s();\n  const [isDesktop, setDesktop] = useState(window.innerWidth >= 768);\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [search, setSearch] = useState('');\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n  useEffect(() => {\n    const handleResize = () => setDesktop(window.innerWidth >= 768);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n      if (!isDesktop) setSidebarOpen(false);\n    }\n  }, [selectedUser, isDesktop]);\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', msg => {\n      if (msg.from === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) || msg.to === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username)) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => {\n      socket.off('receive_message');\n    };\n  }, [selectedUser]);\n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n  const sendMessage = async e => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      // Use both recipient and sender public keys\n      const recipientPublicKey = selectedUser.publicKey;\n      const senderPublicKey = currentUser.publicKey;\n      const {\n        encryptedMessage,\n        encryptedAESKey\n      } = await hybridEncryptMessage(input, [recipientPublicKey, senderPublicKey]);\n      const messageData = {\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      };\n      await messagesAPI.sendMessage(messageData);\n      setMessages(prev => [...prev, {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      }]);\n      getSocket().emit('send_message', {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      });\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus('Failed to send message', 'error');\n    }\n    setLoading(false);\n  };\n  const getAvatar = username => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"avatar\",\n    children: username.slice(0, 2).toUpperCase()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n  const getLastPreview = user => \"Click to view messages\";\n\n  // Filter users by search\n  const filteredUsers = users.filter(u => u.username.toLowerCase().includes(search.toLowerCase()));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    style: {\n      display: 'flex',\n      height: '100vh',\n      minHeight: '100vh',\n      width: '100vw'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `sidebar-wrapper ${isDesktop || isSidebarOpen ? 'sidebar-wrapper--open' : ''}`,\n      style: {\n        minWidth: 0,\n        width: isDesktop ? 240 : isSidebarOpen ? 240 : 0,\n        transition: 'width 0.2s',\n        zIndex: 10,\n        position: isDesktop ? 'relative' : 'absolute',\n        left: 0,\n        top: 0,\n        bottom: 0,\n        background: '#fff'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar-header\",\n        style: {\n          borderBottom: '1px solid #eee',\n          padding: '1.25rem'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 700,\n            fontSize: '1.25rem',\n            color: '#1976d2'\n          },\n          children: \"SecureChat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, this), currentUser && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: 8,\n            fontSize: '1rem',\n            color: '#333',\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 4\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontWeight: 500\n            },\n            children: currentUser.username\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              localStorage.removeItem('token');\n              localStorage.removeItem('user');\n              window.location.reload();\n            },\n            style: {\n              marginTop: 4,\n              background: '#1976d2',\n              color: '#fff',\n              border: 'none',\n              borderRadius: 4,\n              padding: '4px 10px',\n              cursor: 'pointer',\n              fontSize: '0.95rem'\n            },\n            children: \"Logout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar-search\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"sidebar-search__input\",\n          placeholder: \"Search or start new chat\",\n          value: search,\n          onChange: e => setSearch(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MagnifyingGlassIcon, {\n          className: \"sidebar-search__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"user-list-container\",\n        children: /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"user-list\",\n          children: [filteredUsers.map(user => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setSelectedUser(user),\n              className: `user-item ${(selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) === user.username ? 'user-item--selected' : ''}`,\n              style: {\n                width: '100%'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"avatar\",\n                children: [user.username.slice(0, 2).toUpperCase(), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `avatar__status ${user.isOnline ? 'avatar__status--online' : 'avatar__status--offline'}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"user-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"user-info__name\",\n                  children: user.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 191,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"user-info__preview\",\n                  children: getLastPreview(user)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 17\n            }, this)\n          }, user.username, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 15\n          }, this)), filteredUsers.length === 0 && /*#__PURE__*/_jsxDEV(\"li\", {\n            style: {\n              color: '#888',\n              padding: '1rem',\n              textAlign: 'center'\n            },\n            children: \"No users found\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"main-content\",\n      style: {\n        flex: 1,\n        minWidth: 0,\n        display: 'flex',\n        flexDirection: 'column'\n      },\n      children: selectedUser ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-header__left\",\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: '1rem'\n            },\n            children: [!isDesktop && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setSidebarOpen(true),\n              className: \"menu-button\",\n              style: {\n                marginRight: 8\n              },\n              children: /*#__PURE__*/_jsxDEV(Bars3Icon, {\n                className: \"icon-md\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 19\n            }, this), getAvatar(selectedUser.username), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-header__name\",\n                children: selectedUser.username\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 217,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-header__status\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `chat-header__status-dot ${selectedUser.isOnline ? 'chat-header__status-dot--online' : 'chat-header__status-dot--offline'}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 219,\n                  columnNumber: 21\n                }, this), selectedUser.isOnline ? 'Online' : 'Offline']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-header__actions\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"message-list-container\",\n          children: messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(MessageItem, {\n            msg: msg,\n            currentUser: currentUser,\n            getDecryptedPrivateKey: getDecryptedPrivateKey\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: sendMessage,\n          className: \"message-form\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: input,\n            onChange: e => setInput(e.target.value),\n            placeholder: \"Type a message...\",\n            required: true,\n            rows: 1,\n            className: \"message-form__textarea\",\n            onKeyDown: e => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                sendMessage(e);\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            disabled: loading || !input,\n            className: \"message-form__submit\",\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              padding: 0,\n              width: 40,\n              height: 40\n            },\n            title: \"Send\",\n            children: /*#__PURE__*/_jsxDEV(PaperAirplaneIcon, {\n              className: \"icon-submit\",\n              style: {\n                width: 22,\n                height: 22,\n                transform: 'rotate(90deg)'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"welcome-screen\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"welcome-icon\",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"80\",\n            height: \"80\",\n            fill: \"none\",\n            viewBox: \"0 0 80 80\",\n            children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n              cx: \"40\",\n              cy: \"40\",\n              r: \"40\",\n              fill: \"#1976d2\",\n              opacity: \"0.08\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M24 56v-4a8 8 0 018-8h16a8 8 0 018 8v4\",\n              stroke: \"#1976d2\",\n              strokeWidth: \"2\",\n              strokeLinecap: \"round\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"circle\", {\n              cx: \"40\",\n              cy: \"36\",\n              r: \"8\",\n              stroke: \"#1976d2\",\n              strokeWidth: \"2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Welcome to SecureChat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Select a contact from the list to start a secure conversation.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 78\n          }, this), \"Your messages are end-to-end encrypted.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatContainer, \"7JMbayaHIAESx0NEFjyns+ExlmU=\");\n_c = ChatContainer;\nconst MessageItem = ({\n  msg,\n  currentUser,\n  getDecryptedPrivateKey\n}) => {\n  _s2();\n  const [decrypted, setDecrypted] = useState('');\n  useEffect(() => {\n    const decrypt = async () => {\n      try {\n        // Always decrypt, even if sent by current user\n        const privateKeyArmored = await getDecryptedPrivateKey();\n        const dec = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n        setDecrypted(dec);\n      } catch {\n        setDecrypted('[Encrypted]');\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n  const isSent = msg.from === currentUser.username;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `message-item-wrapper ${isSent ? 'message-item-wrapper--sent' : 'message-item-wrapper--received'}`,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `message-bubble ${isSent ? 'message-bubble--sent' : 'message-bubble--received'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: decrypted\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"message-timestamp\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: new Date(msg.timestamp || Date.now()).toLocaleTimeString([], {\n            hour: '2-digit',\n            minute: '2-digit'\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 303,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 299,\n    columnNumber: 5\n  }, this);\n};\n_s2(MessageItem, \"p5qMHw/IAbEL1ybyHdCYv2QSVmY=\");\n_c2 = MessageItem;\nexport default ChatContainer;\nvar _c, _c2;\n$RefreshReg$(_c, \"ChatContainer\");\n$RefreshReg$(_c2, \"MessageItem\");","map":{"version":3,"names":["React","useState","useEffect","useRef","usersAPI","messagesAPI","hybridEncryptMessage","hybridDecryptMessage","decryptPrivateKeyAES","getSocket","PaperAirplaneIcon","MagnifyingGlassIcon","UserCircleIcon","Bars3Icon","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatContainer","currentUser","showStatus","_s","isDesktop","setDesktop","window","innerWidth","isSidebarOpen","setSidebarOpen","users","setUsers","selectedUser","setSelectedUser","messages","setMessages","input","setInput","loading","setLoading","search","setSearch","decryptedPrivateKeyRef","passphraseRef","handleResize","addEventListener","removeEventListener","getAllUsers","then","res","data","getConversation","username","socket","on","msg","from","to","prev","off","getDecryptedPrivateKey","current","encryptedPrivateKey","localStorage","getItem","passphrase","prompt","privateKeyArmored","err","sendMessage","e","preventDefault","recipientPublicKey","publicKey","senderPublicKey","encryptedMessage","encryptedAESKey","messageData","encryptedContent","messageType","emit","getAvatar","className","children","slice","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","getLastPreview","user","filteredUsers","filter","u","toLowerCase","includes","style","display","height","minHeight","width","minWidth","transition","zIndex","position","left","top","bottom","background","borderBottom","padding","fontWeight","fontSize","color","marginTop","flexDirection","gap","onClick","removeItem","location","reload","border","borderRadius","cursor","type","placeholder","value","onChange","target","map","isOnline","length","textAlign","flex","alignItems","marginRight","idx","MessageItem","onSubmit","required","rows","onKeyDown","key","shiftKey","disabled","justifyContent","title","transform","fill","viewBox","cx","cy","r","opacity","d","stroke","strokeWidth","strokeLinecap","_c","_s2","decrypted","setDecrypted","decrypt","dec","isSent","Date","timestamp","now","toLocaleTimeString","hour","minute","_c2","$RefreshReg$"],"sources":["/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { usersAPI, messagesAPI } from '../../services/api';\nimport { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\nimport { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, MagnifyingGlassIcon, UserCircleIcon, Bars3Icon } from '@heroicons/react/24/solid';\nimport './ChatContainer.css';\n\nconst ChatContainer = ({ currentUser, showStatus }) => {\n  const [isDesktop, setDesktop] = useState(window.innerWidth >= 768);\n  const [isSidebarOpen, setSidebarOpen] = useState(false);\n\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [search, setSearch] = useState('');\n\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n\n  useEffect(() => {\n    const handleResize = () => setDesktop(window.innerWidth >= 768);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n      if (!isDesktop) setSidebarOpen(false);\n    }\n  }, [selectedUser, isDesktop]);\n\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', (msg) => {\n      if (msg.from === selectedUser?.username || msg.to === selectedUser?.username) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => {\n      socket.off('receive_message');\n    };\n  }, [selectedUser]);\n\n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      // Use both recipient and sender public keys\n      const recipientPublicKey = selectedUser.publicKey;\n      const senderPublicKey = currentUser.publicKey;\n      const { encryptedMessage, encryptedAESKey } = await hybridEncryptMessage(\n        input,\n        [recipientPublicKey, senderPublicKey]\n      );\n      const messageData = {\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      };\n      await messagesAPI.sendMessage(messageData);\n      setMessages(prev => [\n        ...prev,\n        {\n          from: currentUser.username,\n          to: selectedUser.username,\n          encryptedContent: encryptedMessage,\n          encryptedAESKey,\n          messageType: 'text'\n        }\n      ]);\n      getSocket().emit('send_message', {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      });\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus('Failed to send message', 'error');\n    }\n    setLoading(false);\n  };\n\n  const getAvatar = (username) => (\n    <div className=\"avatar\">{username.slice(0, 2).toUpperCase()}</div>\n  );\n  const getLastPreview = (user) => \"Click to view messages\";\n\n  // Filter users by search\n  const filteredUsers = users.filter(u =>\n    u.username.toLowerCase().includes(search.toLowerCase())\n  );\n\n  return (\n    <div className=\"chat-container\" style={{ display: 'flex', height: '100vh', minHeight: '100vh', width: '100vw' }}>\n      {/* Sidebar */}\n      <aside\n        className={`sidebar-wrapper ${isDesktop || isSidebarOpen ? 'sidebar-wrapper--open' : ''}`}\n        style={{\n          minWidth: 0,\n          width: isDesktop ? 240 : (isSidebarOpen ? 240 : 0),\n          transition: 'width 0.2s',\n          zIndex: 10,\n          position: isDesktop ? 'relative' : 'absolute',\n          left: 0, top: 0, bottom: 0, background: '#fff'\n        }}\n      >\n        <div className=\"sidebar-header\" style={{ borderBottom: '1px solid #eee', padding: '1.25rem' }}>\n          <div style={{ fontWeight: 700, fontSize: '1.25rem', color: '#1976d2' }}>SecureChat</div>\n          {currentUser && (\n            <div style={{ marginTop: 8, fontSize: '1rem', color: '#333', display: 'flex', flexDirection: 'column', gap: 4 }}>\n              <span style={{ fontWeight: 500 }}>{currentUser.username}</span>\n              <button\n                onClick={() => {\n                  localStorage.removeItem('token');\n                  localStorage.removeItem('user');\n                  window.location.reload();\n                }}\n                style={{\n                  marginTop: 4,\n                  background: '#1976d2',\n                  color: '#fff',\n                  border: 'none',\n                  borderRadius: 4,\n                  padding: '4px 10px',\n                  cursor: 'pointer',\n                  fontSize: '0.95rem'\n                }}\n              >\n                Logout\n              </button>\n            </div>\n          )}\n        </div>\n        <div className=\"sidebar-search\">\n          <input\n            type=\"text\"\n            className=\"sidebar-search__input\"\n            placeholder=\"Search or start new chat\"\n            value={search}\n            onChange={e => setSearch(e.target.value)}\n          />\n          <MagnifyingGlassIcon className=\"sidebar-search__icon\" />\n        </div>\n        <div className=\"user-list-container\">\n          <ul className=\"user-list\">\n            {filteredUsers.map(user => (\n              <li key={user.username}>\n                <button\n                  onClick={() => setSelectedUser(user)}\n                  className={`user-item ${selectedUser?.username === user.username ? 'user-item--selected' : ''}`}\n                  style={{ width: '100%' }}\n                >\n                  <div className=\"avatar\">\n                    {user.username.slice(0, 2).toUpperCase()}\n                    <span className={`avatar__status ${user.isOnline ? 'avatar__status--online' : 'avatar__status--offline'}`}></span>\n                  </div>\n                  <div className=\"user-info\">\n                    <div className=\"user-info__name\">{user.username}</div>\n                    <div className=\"user-info__preview\">{getLastPreview(user)}</div>\n                  </div>\n                </button>\n              </li>\n            ))} \n            {filteredUsers.length === 0 && (\n              <li style={{ color: '#888', padding: '1rem', textAlign: 'center' }}>No users found</li>\n            )}\n          </ul>\n        </div>\n      </aside>\n\n      {/* Main Chat */}\n      <main className=\"main-content\" style={{ flex: 1, minWidth: 0, display: 'flex', flexDirection: 'column' }}>\n        {selectedUser ? (\n          <>\n            <div className=\"chat-header\">\n              <div className=\"chat-header__left\" style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\n                {!isDesktop && (\n                  <button onClick={() => setSidebarOpen(true)} className=\"menu-button\" style={{ marginRight: 8 }}>\n                    <Bars3Icon className=\"icon-md\" />\n                  </button>\n                )}\n                {getAvatar(selectedUser.username)}\n                <div>\n                  <div className=\"chat-header__name\">{selectedUser.username}</div>\n                  <div className=\"chat-header__status\">\n                    <span className={`chat-header__status-dot ${selectedUser.isOnline ? 'chat-header__status-dot--online' : 'chat-header__status-dot--offline'}`}></span>\n                    {selectedUser.isOnline ? 'Online' : 'Offline'}\n                  </div>\n                </div>\n              </div>\n              <div className=\"chat-header__actions\">\n                {/* Add more header actions here if needed */}\n              </div>\n            </div>\n\n            <div className=\"message-list-container\">\n              {messages.map((msg, idx) => (\n                <MessageItem key={idx} msg={msg} currentUser={currentUser} getDecryptedPrivateKey={getDecryptedPrivateKey} />\n              ))}\n            </div>\n\n            <form onSubmit={sendMessage} className=\"message-form\">\n              <textarea\n                value={input}\n                onChange={e => setInput(e.target.value)}\n                placeholder=\"Type a message...\"\n                required\n                rows={1}\n                className=\"message-form__textarea\"\n                onKeyDown={e => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    sendMessage(e);\n                  }\n                }}\n              />\n              <button\n                type=\"submit\"\n                disabled={loading || !input}\n                className=\"message-form__submit\"\n                style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 0, width: 40, height: 40 }}\n                title=\"Send\"\n              >\n                <PaperAirplaneIcon className=\"icon-submit\" style={{ width: 22, height: 22, transform: 'rotate(90deg)' }} />\n              </button>\n            </form>\n          </>\n        ) : (\n          <div className=\"welcome-screen\">\n            <div className=\"welcome-icon\">\n              <svg width=\"80\" height=\"80\" fill=\"none\" viewBox=\"0 0 80 80\">\n                <circle cx=\"40\" cy=\"40\" r=\"40\" fill=\"#1976d2\" opacity=\"0.08\"/>\n                <path d=\"M24 56v-4a8 8 0 018-8h16a8 8 0 018 8v4\" stroke=\"#1976d2\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\n                <circle cx=\"40\" cy=\"36\" r=\"8\" stroke=\"#1976d2\" strokeWidth=\"2\"/>\n              </svg>\n            </div>\n            <h2>Welcome to SecureChat</h2>\n            <p>Select a contact from the list to start a secure conversation.<br/>Your messages are end-to-end encrypted.</p>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n};\n\nconst MessageItem = ({ msg, currentUser, getDecryptedPrivateKey }) => {\n  const [decrypted, setDecrypted] = useState('');\n\n  useEffect(() => {\n    const decrypt = async () => {\n      try {\n        // Always decrypt, even if sent by current user\n        const privateKeyArmored = await getDecryptedPrivateKey();\n        const dec = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n        setDecrypted(dec);\n      } catch {\n        setDecrypted('[Encrypted]');\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n\n  const isSent = msg.from === currentUser.username;\n\n  return (\n    <div className={`message-item-wrapper ${isSent ? 'message-item-wrapper--sent' : 'message-item-wrapper--received'}`}>\n      <div className={`message-bubble ${isSent ? 'message-bubble--sent' : 'message-bubble--received'}`}>\n        <p>{decrypted}</p>\n        <div className=\"message-timestamp\">\n          <span>{new Date(msg.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatContainer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { usersAPI, messagesAPI } from '../../services/api';\nimport { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\nimport { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, LockClosedIcon, PhoneIcon, EllipsisVerticalIcon, MagnifyingGlassIcon, FaceSmileIcon, PaperClipIcon, UserCircleIcon } from '@heroicons/react/24/solid';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst ChatContainer = ({\n  currentUser,\n  showStatus\n}) => {\n  _s();\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  // Cache decrypted private key for session\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n    }\n  }, [selectedUser]);\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', msg => {\n      if (msg.from === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) || msg.to === (selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username)) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => {\n      socket.off('receive_message');\n    };\n  }, [selectedUser]);\n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n  const sendMessage = async e => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      const {\n        encryptedMessage,\n        encryptedAESKey\n      } = await hybridEncryptMessage(input, selectedUser.publicKey);\n      const messageData = {\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      };\n      await messagesAPI.sendMessage(messageData);\n      setMessages(prev => [...prev, {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text',\n        plaintext: input\n      }]);\n      getSocket().emit('send_message', {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      });\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus('Failed to send message', 'error');\n    }\n    setLoading(false);\n  };\n  const getAvatar = username => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative flex items-center justify-center w-10 h-10 rounded-full bg-slate-600 text-white font-bold text-lg select-none\",\n    children: username.slice(0, 2).toUpperCase()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n  const getLastPreview = user => {\n    return \"Click to view messages\";\n  };\n  const renderUsers = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex-1 overflow-y-auto px-2\",\n    children: /*#__PURE__*/_jsxDEV(\"ul\", {\n      className: \"space-y-1 pt-2\",\n      children: users.map(user => /*#__PURE__*/_jsxDEV(\"li\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setSelectedUser(user),\n          className: `w-full flex items-center gap-4 px-3 py-2 rounded-lg transition-colors duration-150 hover:bg-slate-700/50 focus:outline-none ${(selectedUser === null || selectedUser === void 0 ? void 0 : selectedUser.username) === user.username ? 'bg-slate-700' : ''}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [getAvatar(user.username), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `absolute bottom-0 right-0 block w-3 h-3 rounded-full border-2 border-slate-800 ${user.isOnline ? 'bg-green-400' : 'bg-gray-400'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 text-left\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-semibold text-base text-gray-200\",\n              children: user.username\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-sm text-gray-400 truncate\",\n              children: getLastPreview(user)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 17\n        }, this)\n      }, user.username, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 5\n  }, this);\n  const renderMessages = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col-reverse gap-2 overflow-y-auto h-full px-4 py-2\",\n    children: messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(MessageItem, {\n      msg: msg,\n      currentUser: currentUser,\n      getDecryptedPrivateKey: getDecryptedPrivateKey\n    }, idx, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }, this))\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n  return (\n    /*#__PURE__*/\n    // --- FIX: Using inline styles for the main flex container ---\n    _jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        height: '100vh'\n      },\n      className: \"font-sans bg-slate-900 text-gray-300\",\n      children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n        style: {\n          width: '20rem',\n          flexShrink: 0\n        },\n        className: \"flex flex-col bg-slate-800 text-gray-200 border-r border-slate-700 h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"px-5 py-4\",\n          children: /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-xl font-bold text-gray-100\",\n            children: \"SecureChat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"px-5 pb-4\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              className: \"w-full pl-10 pr-3 py-2 rounded-md bg-slate-900 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition\",\n              placeholder: \"Search or start new chat\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(MagnifyingGlassIcon, {\n              style: {\n                width: '1.25rem',\n                height: '1.25rem'\n              },\n              className: \"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 9\n        }, this), renderUsers()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n        style: {\n          flex: '1 1 0%',\n          minWidth: 0\n        },\n        className: \"relative flex flex-col h-full bg-slate-900\",\n        children: selectedUser ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center justify-between px-6 py-4 bg-slate-900/80 backdrop-blur-sm border-b border-slate-700\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-3\",\n              children: [getAvatar(selectedUser.username), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"font-bold text-lg text-white\",\n                  children: selectedUser.username\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 192,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center gap-1.5 text-xs text-gray-400\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: `w-2 h-2 rounded-full ${selectedUser.isOnline ? 'bg-green-400' : 'bg-gray-400'}`\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 194,\n                    columnNumber: 21\n                  }, this), selectedUser.isOnline ? 'Online' : 'Offline']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 193,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 191,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"p-2 rounded-full hover:bg-slate-800 transition\",\n                children: /*#__PURE__*/_jsxDEV(PhoneIcon, {\n                  style: {\n                    width: '1.25rem',\n                    height: '1.25rem'\n                  },\n                  className: \"text-gray-400\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 201,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"p-2 rounded-full hover:bg-slate-800 transition\",\n                children: /*#__PURE__*/_jsxDEV(EllipsisVerticalIcon, {\n                  style: {\n                    width: '1.25rem',\n                    height: '1.25rem'\n                  },\n                  className: \"text-gray-400\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 204,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 203,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto flex flex-col-reverse p-4\",\n            children: renderMessages()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: sendMessage,\n            className: \"flex items-center gap-3 px-4 py-3 bg-slate-800 border-t border-slate-700\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"p-2 rounded-full hover:bg-slate-700 transition\",\n              children: /*#__PURE__*/_jsxDEV(FaceSmileIcon, {\n                style: {\n                  width: '1.5rem',\n                  height: '1.5rem'\n                },\n                className: \"text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 220,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 219,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"p-2 rounded-full hover:bg-slate-700 transition\",\n              children: /*#__PURE__*/_jsxDEV(PaperClipIcon, {\n                style: {\n                  width: '1.5rem',\n                  height: '1.5rem'\n                },\n                className: \"text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: input,\n              onChange: e => setInput(e.target.value),\n              placeholder: \"Type a message...\",\n              required: true,\n              rows: 1,\n              className: \"flex-1 resize-none bg-slate-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition placeholder-gray-400\",\n              style: {\n                minHeight: '2.75rem',\n                maxHeight: '10rem'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              disabled: loading || !input,\n              className: `p-3 rounded-full bg-indigo-600 hover:bg-indigo-700 transition shadow-lg flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`,\n              children: /*#__PURE__*/_jsxDEV(PaperAirplaneIcon, {\n                style: {\n                  width: '1.5rem',\n                  height: '1.5rem'\n                },\n                className: \"text-white\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 239,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col items-center justify-center h-full text-center text-gray-400 p-8\",\n          children: [/*#__PURE__*/_jsxDEV(UserCircleIcon, {\n            style: {\n              width: '6rem',\n              height: '6rem'\n            },\n            className: \"text-slate-700 mb-6\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-3xl font-medium text-gray-200 mb-2\",\n            children: \"Welcome to SecureChat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-lg text-gray-400\",\n            children: \"Your conversations are end-to-end encrypted.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-1 text-gray-500\",\n            children: \"Select a user from the sidebar to begin a secure conversation.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute bottom-5 right-5\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"p-2 rounded-full bg-slate-700 hover:bg-slate-600 transition\",\n              children: /*#__PURE__*/_jsxDEV(EllipsisVerticalIcon, {\n                style: {\n                  width: '1.5rem',\n                  height: '1.5rem'\n                },\n                className: \"text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 5\n    }, this)\n  );\n};\n_s(ChatContainer, \"GJpm+MdPniKdLATSdJsToePJPDc=\");\n_c = ChatContainer;\nconst MessageItem = ({\n  msg,\n  currentUser,\n  getDecryptedPrivateKey\n}) => {\n  _s2();\n  const [decrypted, setDecrypted] = useState('');\n  useEffect(() => {\n    const decrypt = async () => {\n      if (msg.from === currentUser.username && msg.plaintext) {\n        setDecrypted(msg.plaintext);\n      } else {\n        try {\n          const privateKeyArmored = await getDecryptedPrivateKey();\n          const dec = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n          setDecrypted(dec);\n        } catch {\n          setDecrypted('[Encrypted]');\n        }\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n  const isSent = msg.from === currentUser.username;\n  const bubbleClasses = isSent ? 'bg-indigo-600 text-white self-end rounded-xl shadow-md' : 'bg-slate-700 text-gray-200 self-start rounded-xl shadow';\n  const alignClasses = isSent ? 'justify-end' : 'justify-start';\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `flex w-full ${alignClasses}`,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `max-w-xl px-4 py-2 ${bubbleClasses}`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"break-words\",\n        children: decrypted\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-right text-xs text-gray-300/70 mt-1\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: new Date(msg.timestamp || Date.now()).toLocaleTimeString([], {\n            hour: '2-digit',\n            minute: '2-digit'\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n};\n_s2(MessageItem, \"p5qMHw/IAbEL1ybyHdCYv2QSVmY=\");\n_c2 = MessageItem;\nexport default ChatContainer;\nvar _c, _c2;\n$RefreshReg$(_c, \"ChatContainer\");\n$RefreshReg$(_c2, \"MessageItem\");","map":{"version":3,"names":["React","useState","useEffect","useRef","usersAPI","messagesAPI","hybridEncryptMessage","hybridDecryptMessage","decryptPrivateKeyAES","getSocket","PaperAirplaneIcon","LockClosedIcon","PhoneIcon","EllipsisVerticalIcon","MagnifyingGlassIcon","FaceSmileIcon","PaperClipIcon","UserCircleIcon","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatContainer","currentUser","showStatus","_s","users","setUsers","selectedUser","setSelectedUser","messages","setMessages","input","setInput","loading","setLoading","decryptedPrivateKeyRef","passphraseRef","getAllUsers","then","res","data","getConversation","username","socket","on","msg","from","to","prev","off","getDecryptedPrivateKey","current","encryptedPrivateKey","localStorage","getItem","passphrase","window","prompt","privateKeyArmored","err","sendMessage","e","preventDefault","encryptedMessage","encryptedAESKey","publicKey","messageData","encryptedContent","messageType","plaintext","emit","getAvatar","className","children","slice","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","getLastPreview","user","renderUsers","map","onClick","isOnline","renderMessages","idx","MessageItem","style","display","height","width","flexShrink","type","placeholder","flex","minWidth","onSubmit","value","onChange","target","required","rows","minHeight","maxHeight","disabled","_c","_s2","decrypted","setDecrypted","decrypt","dec","isSent","bubbleClasses","alignClasses","Date","timestamp","now","toLocaleTimeString","hour","minute","_c2","$RefreshReg$"],"sources":["/home/rounak-dagar/securechat/frontend/src/components/Chat/ChatContainer.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { usersAPI, messagesAPI } from '../../services/api';\nimport { hybridEncryptMessage, hybridDecryptMessage, decryptPrivateKeyAES } from '../../services/crypto';\nimport { getSocket } from '../../services/socket';\nimport { PaperAirplaneIcon, LockClosedIcon, PhoneIcon, EllipsisVerticalIcon, MagnifyingGlassIcon, FaceSmileIcon, PaperClipIcon, UserCircleIcon } from '@heroicons/react/24/solid';\n\nconst ChatContainer = ({ currentUser, showStatus }) => {\n  const [users, setUsers] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n\n  // Cache decrypted private key for session\n  const decryptedPrivateKeyRef = useRef(null);\n  const passphraseRef = useRef('');\n\n  useEffect(() => {\n    usersAPI.getAllUsers().then(res => setUsers(res.data));\n  }, []);\n\n  useEffect(() => {\n    if (selectedUser) {\n      messagesAPI.getConversation(selectedUser.username).then(res => setMessages(res.data));\n    }\n  }, [selectedUser]);\n\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n    socket.on('receive_message', (msg) => {\n      if (msg.from === selectedUser?.username || msg.to === selectedUser?.username) {\n        setMessages(prev => [...prev, msg]);\n      }\n    });\n    return () => {\n      socket.off('receive_message');\n    };\n  }, [selectedUser]);\n\n  const getDecryptedPrivateKey = async () => {\n    if (decryptedPrivateKeyRef.current) return decryptedPrivateKeyRef.current;\n    const encryptedPrivateKey = localStorage.getItem('privateKey');\n    let passphrase = passphraseRef.current;\n    if (!passphrase) {\n      passphrase = window.prompt('Enter your password to decrypt your private key:');\n      passphraseRef.current = passphrase;\n    }\n    try {\n      const privateKeyArmored = await decryptPrivateKeyAES(encryptedPrivateKey, passphrase);\n      decryptedPrivateKeyRef.current = privateKeyArmored;\n      return privateKeyArmored;\n    } catch (err) {\n      showStatus('Failed to decrypt private key. Wrong password?', 'error');\n      decryptedPrivateKeyRef.current = null;\n      passphraseRef.current = '';\n      throw err;\n    }\n  };\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!input || !selectedUser) return;\n    setLoading(true);\n    try {\n      const { encryptedMessage, encryptedAESKey } = await hybridEncryptMessage(input, selectedUser.publicKey);\n      const messageData = {\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      };\n      await messagesAPI.sendMessage(messageData);\n      setMessages(prev => [\n        ...prev,\n        {\n          from: currentUser.username,\n          to: selectedUser.username,\n          encryptedContent: encryptedMessage,\n          encryptedAESKey,\n          messageType: 'text',\n          plaintext: input\n        }\n      ]);\n      getSocket().emit('send_message', {\n        from: currentUser.username,\n        to: selectedUser.username,\n        encryptedContent: encryptedMessage,\n        encryptedAESKey,\n        messageType: 'text'\n      });\n      setInput('');\n      showStatus('Message sent', 'success');\n    } catch (err) {\n      showStatus('Failed to send message', 'error');\n    }\n    setLoading(false);\n  };\n\n  const getAvatar = (username) => (\n    <div className=\"relative flex items-center justify-center w-10 h-10 rounded-full bg-slate-600 text-white font-bold text-lg select-none\">\n      {username.slice(0, 2).toUpperCase()}\n    </div>\n  );\n  \n  const getLastPreview = (user) => {\n    return \"Click to view messages\";\n  };\n\n  const renderUsers = () => (\n    <div className=\"flex-1 overflow-y-auto px-2\">\n        <ul className=\"space-y-1 pt-2\">\n            {users.map(user => (\n                <li key={user.username}>\n                <button\n                    onClick={() => setSelectedUser(user)}\n                    className={`w-full flex items-center gap-4 px-3 py-2 rounded-lg transition-colors duration-150 hover:bg-slate-700/50 focus:outline-none ${\n                    selectedUser?.username === user.username ? 'bg-slate-700' : ''\n                    }`}\n                >\n                    <div className=\"relative\">\n                    {getAvatar(user.username)}\n                    <span className={`absolute bottom-0 right-0 block w-3 h-3 rounded-full border-2 border-slate-800 ${user.isOnline ? 'bg-green-400' : 'bg-gray-400'}`}></span>\n                    </div>\n                    <div className=\"flex-1 text-left\">\n                    <div className=\"font-semibold text-base text-gray-200\">{user.username}</div>\n                    <div className=\"text-sm text-gray-400 truncate\">{getLastPreview(user)}</div>\n                    </div>\n                </button>\n                </li>\n            ))}\n        </ul>\n    </div>\n  );\n\n  const renderMessages = () => (\n    <div className=\"flex flex-col-reverse gap-2 overflow-y-auto h-full px-4 py-2\">\n      {messages.map((msg, idx) => (\n        <MessageItem\n          key={idx}\n          msg={msg}\n          currentUser={currentUser}\n          getDecryptedPrivateKey={getDecryptedPrivateKey}\n        />\n      ))}\n    </div>\n  );\n\n  return (\n    // --- FIX: Using inline styles for the main flex container ---\n    <div \n      style={{ display: 'flex', height: '100vh' }}\n      className=\"font-sans bg-slate-900 text-gray-300\"\n    >\n      {/* Sidebar */}\n      {/* --- FIX: Using inline styles for the sidebar's width and shrink behavior --- */}\n      <aside \n        style={{ width: '20rem', flexShrink: 0 }}\n        className=\"flex flex-col bg-slate-800 text-gray-200 border-r border-slate-700 h-full\"\n      >\n        <div className=\"px-5 py-4\">\n            <h1 className=\"text-xl font-bold text-gray-100\">SecureChat</h1>\n        </div>\n        <div className=\"px-5 pb-4\">\n            <div className=\"relative\">\n            <input\n              type=\"text\"\n              className=\"w-full pl-10 pr-3 py-2 rounded-md bg-slate-900 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition\"\n              placeholder=\"Search or start new chat\"\n            />\n            <MagnifyingGlassIcon \n              style={{ width: '1.25rem', height: '1.25rem' }}\n              className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500\" />\n          </div>\n        </div>\n        {renderUsers()}\n      </aside>\n\n      {/* Main Chat Area */}\n      {/* --- FIX: Using inline styles for the main content's grow behavior --- */}\n      <main \n        style={{ flex: '1 1 0%', minWidth: 0 }}\n        className=\"relative flex flex-col h-full bg-slate-900\"\n      >\n        {selectedUser ? (\n          <>\n            {/* Header Bar */}\n            <div className=\"flex items-center justify-between px-6 py-4 bg-slate-900/80 backdrop-blur-sm border-b border-slate-700\">\n              <div className=\"flex items-center gap-3\">\n                {getAvatar(selectedUser.username)}\n                <div>\n                  <div className=\"font-bold text-lg text-white\">{selectedUser.username}</div>\n                  <div className=\"flex items-center gap-1.5 text-xs text-gray-400\">\n                    <span className={`w-2 h-2 rounded-full ${selectedUser.isOnline ? 'bg-green-400' : 'bg-gray-400'}`}></span>\n                    {selectedUser.isOnline ? 'Online' : 'Offline'}\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <button className=\"p-2 rounded-full hover:bg-slate-800 transition\">\n                  <PhoneIcon style={{ width: '1.25rem', height: '1.25rem' }} className=\"text-gray-400\" />\n                </button>\n                <button className=\"p-2 rounded-full hover:bg-slate-800 transition\">\n                  <EllipsisVerticalIcon style={{ width: '1.25rem', height: '1.25rem' }} className=\"text-gray-400\" />\n                </button>\n              </div>\n            </div>\n\n            {/* Message List */}\n            <div className=\"flex-1 overflow-y-auto flex flex-col-reverse p-4\">\n              {renderMessages()}\n            </div>\n\n            {/* Message Composer */}\n            <form\n              onSubmit={sendMessage}\n              className=\"flex items-center gap-3 px-4 py-3 bg-slate-800 border-t border-slate-700\"\n            >\n              <button type=\"button\" className=\"p-2 rounded-full hover:bg-slate-700 transition\">\n                <FaceSmileIcon style={{ width: '1.5rem', height: '1.5rem' }} className=\"text-gray-400\" />\n              </button>\n              <button type=\"button\" className=\"p-2 rounded-full hover:bg-slate-700 transition\">\n                <PaperClipIcon style={{ width: '1.5rem', height: '1.5rem' }} className=\"text-gray-400\" />\n              </button>\n              <textarea\n                value={input}\n                onChange={e => setInput(e.target.value)}\n                placeholder=\"Type a message...\"\n                required\n                rows={1}\n                className=\"flex-1 resize-none bg-slate-700 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition placeholder-gray-400\"\n                style={{ minHeight: '2.75rem', maxHeight: '10rem' }}\n              />\n              <button\n                type=\"submit\"\n                disabled={loading || !input}\n                className={`p-3 rounded-full bg-indigo-600 hover:bg-indigo-700 transition shadow-lg flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`}\n              >\n                <PaperAirplaneIcon style={{ width: '1.5rem', height: '1.5rem' }} className=\"text-white\" />\n              </button>\n            </form>\n          </>\n        ) : (\n          <div className=\"flex flex-col items-center justify-center h-full text-center text-gray-400 p-8\">\n            <UserCircleIcon style={{ width: '6rem', height: '6rem' }} className=\"text-slate-700 mb-6\"/>\n            <h2 className=\"text-3xl font-medium text-gray-200 mb-2\">Welcome to SecureChat</h2>\n            <p className=\"text-lg text-gray-400\">Your conversations are end-to-end encrypted.</p>\n            <p className=\"mt-1 text-gray-500\">Select a user from the sidebar to begin a secure conversation.</p>\n            <div className=\"absolute bottom-5 right-5\">\n              <button className=\"p-2 rounded-full bg-slate-700 hover:bg-slate-600 transition\">\n                <EllipsisVerticalIcon style={{ width: '1.5rem', height: '1.5rem' }} className=\"text-gray-400\"/>\n              </button>\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n};\n\nconst MessageItem = ({ msg, currentUser, getDecryptedPrivateKey }) => {\n  const [decrypted, setDecrypted] = useState('');\n\n  useEffect(() => {\n    const decrypt = async () => {\n      if (msg.from === currentUser.username && msg.plaintext) {\n        setDecrypted(msg.plaintext);\n      } else {\n        try {\n          const privateKeyArmored = await getDecryptedPrivateKey();\n          const dec = await hybridDecryptMessage(msg.encryptedContent, msg.encryptedAESKey, privateKeyArmored);\n          setDecrypted(dec);\n        } catch {\n          setDecrypted('[Encrypted]');\n        }\n      }\n    };\n    decrypt();\n  }, [msg, currentUser, getDecryptedPrivateKey]);\n\n  const isSent = msg.from === currentUser.username;\n  const bubbleClasses = isSent\n    ? 'bg-indigo-600 text-white self-end rounded-xl shadow-md'\n    : 'bg-slate-700 text-gray-200 self-start rounded-xl shadow';\n  const alignClasses = isSent ? 'justify-end' : 'justify-start';\n\n  return (\n    <div className={`flex w-full ${alignClasses}`}>\n      <div className={`max-w-xl px-4 py-2 ${bubbleClasses}`}>\n        <p className=\"break-words\">{decrypted}</p>\n        <div className=\"text-right text-xs text-gray-300/70 mt-1\">\n          <span>{new Date(msg.timestamp || Date.now()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatContainer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}